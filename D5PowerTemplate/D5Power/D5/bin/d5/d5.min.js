var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);i.prototype=e.prototype,t.prototype=new i},d5power;!function(t){var e=function(){function t(t){this._manager=t,this.runid=t.runid}return t.prototype.check=function(){null!=this.next&&this.runid==this._manager.runid&&(this.next.think(),this.next.check())},t}();t.NodeBase=e,__reflect(e.prototype,"d5power.NodeBase")}(d5power||(d5power={}));var d5power;!function(t){var e=function(){function e(t){this.speed=3,this._pos=new egret.Point,this._map=t}return Object.defineProperty(e.prototype,"posX",{get:function(){return this._pos.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"posY",{get:function(){return this._pos.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"$pos",{get:function(){return this._pos},enumerable:!0,configurable:!0}),e.prototype.setPos=function(t,e){t=Math.ceil(t),e=Math.ceil(e),this._pos.x=t,this._pos.y=e},e.prototype.render=function(t){},e.prototype.run=function(t){},Object.defineProperty(e.prototype,"monitor",{get:function(){return this._monitor},enumerable:!0,configurable:!0}),e.prototype.updatePos=function(e,i){void 0===e&&(e=0),void 0===i&&(i=0);var r=this._pos.x,o=this._pos.y;if(this._map){var s=this._map.width>t.D5Game.screenWidth,n=this._map.height>t.D5Game.screenHeight;if(this.beFocus&&s&&n){var a=s?t.D5Game.screenWidth:this._map.width,h=n?t.D5Game.screenHeight:this._map.height;r=r>this._map.width-(a>>1)?r-(this._map.width-a):r,o=o>this._map.height-(h>>1)?o-(this._map.height-h):o,r=r>a>>1&&r==this._pos.x?a>>1:r,o=o>h>>1&&o==this._pos.y?h>>1:o}else{var p=this._map.getScreenPostion(r,o);r=p.x,o=p.y}}null!=this._monitor&&(this._monitor.x=r+e,this._monitor.y=o+i)},e}();t.GameObject=e,__reflect(e.prototype,"d5power.GameObject",["d5power.IGD"])}(d5power||(d5power={}));var d5power;!function(t){var e=function(){function e(t){this.iscomplate=!1,this.id=t,this.need=[],this.give=[]}return e.prototype.formatFromJSON=function(e){this.type=e.type,this.name=e.name,this.info=e.info,this.npc_id=e.say,this.npc_id=e.npc,this.uncompDialog=e.uncomp,this.complate_script=e.complateScript,this.complate_script=null==this.complate_script||"null"==this.complate_script?"":this.complate_script;var i;null==this.need&&(this.need=[],this.give=[]);for(var r in e.need){var o=e.need[r];i=new t.ThreeBase,i.type=o.type,i.key=o.key,i.count=o.count,this.need.push(i)}for(r in e.give)o=e.give[r],i=new t.ThreeBase,i.type=o.type,i.key=o.key,i.count=o.count,this.give.push(i)},Object.defineProperty(e.prototype,"needstring",{get:function(){var e="";for(var i in this.need){var r=this.need[i];e+=t.MissionNR.getChinese(r.type)+"()"}return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isComplate",{get:function(){return this.iscomplate},enumerable:!0,configurable:!0}),e.prototype.addNeed=function(t){-1==this.need.indexOf(t)&&this.need.push(t)},e.prototype.addGive=function(t){-1==this.give.indexOf(t)&&this.give.push(t)},e.prototype.check=function(e){if(this.iscomplate=!0,null!=this.need)for(var i in this.need){var r=this.need[i];switch(r.type){case t.MissionNR.N_ITEM_NEED:case t.MissionNR.N_ITEM_TACKED:this.iscomplate=this.iscomplate&&e.hasItemNum(r.key)>=r.count;break;case t.MissionNR.N_MONEY:case t.MissionNR.N_MONEY_KEEP:this.iscomplate=this.iscomplate&&e.hasMoney(r.key);break;case t.MissionNR.N_MARK:this.iscomplate=this.iscomplate&&e.hasMark(r.key);break;case t.MissionNR.N_MONSTER_KILLED:this.iscomplate=this.iscomplate&&e.killMonseterNum(r.key)>=r.count;break;case t.MissionNR.N_PLAYER_PROP:this.iscomplate=this.iscomplate&&e.userPro(r.key,r.count);break;case t.MissionNR.N_MISSION:this.iscomplate=this.iscomplate&&e.hasMission(r.key);break;case t.MissionNR.N_TALK_NPC:this.iscomplate=this.iscomplate&&e.hasTalkedWith(r.key);break;default:e.hasChecker(r.type)&&(this.iscomplate=this.iscomplate&&e.custormCheck(r))}}return this.iscomplate},e.prototype.complate=function(e){if(!this.check(e))return!1;if(e.deleteMission(this),null!=this.give)for(var i in this.give){var r=this.give[i];switch(r.type){case t.MissionNR.R_ITEM:e.getItem(r.key,r.count);break;case t.MissionNR.R_MONEY:e.getMoney(r.count);break;case t.MissionNR.R_EXP:e.getExp(r.count);break;case t.MissionNR.R_MISSION:e.addMission(r.key)}}return!0},e.TYPE_GET=0,e.TYPE_COMPLATE=1,e}();t.MissionData=e,__reflect(e.prototype,"d5power.MissionData")}(d5power||(d5power={}));var d5power;!function(t){var e=function(e){function i(i){var r=e.call(this,i)||this;return r.vars=[],r._manager=i,r.type=t.NodeType.Add,r}return __extends(i,e),i.prototype.addVar=function(t){this.vars.push(t)},i.prototype.think=function(){var e;this._value=0;for(var i=0,r=this.vars.length;r>i;i++)e=this.vars[i],e.getValue?this._value+=e.getValue():t.ScriptRunner.varLibs[e]||t.ScriptRunner.staticLibs[e]?this._value+=t.ScriptRunner.varLibs[e]?t.ScriptRunner.varLibs[e]:t.ScriptRunner.staticLibs[e]:this._value+=e},i.prototype.getValue=function(){return this.think(),this._value},i.prototype.dispose=function(){this._manager=null,this.vars=null},i.prototype.format=function(e){if(e.id>0&&e.id<t.NodeType.MAX_ID){this.id=e.id;for(var i,r=[],o=0;o<e.vars.length;o++)i=e.vars[o],"#"==i.substr(0,1)&&(i=this._manager.getNode(parseInt(i.substr(1))),i||(i=0)),r.push(i);this.vars=r}else console.error("[NodeAdd]解析失败")},Object.defineProperty(i.prototype,"obj",{get:function(){var e={};e.type=t.NodeType.Add,i.id=this.id;for(var i,r=[],o=0;o<this.vars.length;o++)i=this.vars[o],i.getValue?r.push("#"+i.id):r.push(i);return i.vars=r,e},enumerable:!0,configurable:!0}),i}(t.NodeBase);t.NodeAdd=e,__reflect(e.prototype,"d5power.NodeAdd",["d5power.IScriptNode","d5power.IScriptNumber"])}(d5power||(d5power={}));var d5power;!function(t){var e=function(){function t(){}return t.Var=0,t.Add=1,t.MAX_ID=999,t}();t.NodeType=e,__reflect(e.prototype,"d5power.NodeType")}(d5power||(d5power={}));var d5power;!function(t){var e=function(e){function i(i){var r=e.call(this,i)||this;return r.area=0,r.type=t.NodeType.Var,r}return __extends(i,e),i.prototype.think=function(){null!=this.name&&(this.area==i.AREA_SCENE?t.ScriptRunner.varLibs[this.name]=this.value:t.ScriptRunner.staticLibs[this.name]=this.value)},i.prototype.getValue=function(){return parseInt(this.value)},Object.defineProperty(i.prototype,"obj",{get:function(){var e={};return e.name=this.name,e.value=this.value,e.id=this.id,e.type=t.NodeType.Var,e},enumerable:!0,configurable:!0}),i.prototype.format=function(e){e.type>0&&e.type<t.NodeType.MAX_ID?(this.id=e.id,this.name=e.name,this.value=e.value):console.error("[NodeVar]解析失败")},i.prototype.dispose=function(){},i.AREA_SCENE=0,i.AREA_PUBLI=1,i}(t.NodeBase);t.NodeVar=e,__reflect(e.prototype,"d5power.NodeVar",["d5power.IScriptNode","d5power.IScriptNumber"])}(d5power||(d5power={}));var d5power;!function(t){var e=function(){function t(){return this._lastPulse=0,null!=t._me?void console.error("[ScriptRunner] please get instance throw getInstance function."):(this._nodeLib=[],this.reset(),void(t.staticLibs={}))}return t.getInstance=function(){return null==t._me&&(t._me=new t),t._me},Object.defineProperty(t,"index",{get:function(){return t._index++,t._index},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"runid",{get:function(){return t._runid},enumerable:!0,configurable:!0}),t.prototype.init=function(e,i){t._index=0,e.apply(i)},t.prototype.reset=function(){for(var e=this._nodeLib.length-1;e>=0;e--)this._nodeLib[e].dispose();this._nodeLib=[],this._tree=[],t.varLibs={},t._runid++},t.prototype.getNode=function(t){var e;if(this._nodeLib.length)for(var i=0,r=this._nodeLib.length;r>i;i++)if(e=this._nodeLib[i],e.id==t)return e;return null},t.prototype.giveId=function(e,i){return void 0===i&&(i=-1),e.id=-1==i?t.index:i,e.id},t.prototype.changeScene=function(){this.reset()},t.prototype.addNode=function(t){-1==this._tree.indexOf(t)&&(this._nodeLib.push(t),this._tree.push(t))},t.prototype.check=function(e){if(!(e-this._lastPulse<t._pulse)){this._lastPulse=e;for(var i,r=this._tree.length-1;r>=0;r--)i=this._tree[r],i.think(),i.check(),this._tree.pop()}},t._pulse=200,t._runid=0,t._index=-1,t}();t.ScriptRunner=e,__reflect(e.prototype,"d5power.ScriptRunner",["d5power.INodeManager"])}(d5power||(d5power={}));var d5power;!function(t){var e=function(){function t(){}return t}();t.ThreeBase=e,__reflect(e.prototype,"d5power.ThreeBase")}(d5power||(d5power={}));var d5power;!function(t){var e=function(){function e(){}return e.prototype.format=function(e){this.id=e.uid,this.name=e.name,this.posx=e.posx,this.posy=e.posy,this.say=e.say,this.script=e.script,null!=e.job&&(this.job=new t.ThreeBase,this.job.type=e.job.type,this.job.key=e.job.value,this.job.count=e.job.num)},e}();t.NPConf=e,__reflect(e.prototype,"d5power.NPConf")}(d5power||(d5power={}));var d5power;!function(t){var e=function(){function t(){}return t}();t.DisplayPluginData=e,__reflect(e.prototype,"d5power.DisplayPluginData")}(d5power||(d5power={}));var d5power;!function(t){var e=function(){function t(){this.id=0,this.name="",this.info="",this.buy=0,this.sale=0,this.canAdd=!0}return t.prototype.format=function(t){this.id=parseInt(t.id),this.name=t.name,this.info=t.info,this.buy=t.buy,this.sale=t.sale,this.canAdd=t.canAdd},t}();t.ItemData=e,__reflect(e.prototype,"d5power.ItemData")}(d5power||(d5power={}));var d5power;!function(t){var e=function(){function t(){}return t.addCostomDefine=function(e){return parseInt(e.key)<=t.SAVE_KEY?!1:(t.COSTOM_DEFINE.push(e),!0)},t.getChinese=function(e){switch(void 0===e&&(e=0),e){case t.N_MONSTER_KILLED:return"杀死怪物";case t.N_ITEM_NEED:return"拥有道具（扣除）";case t.N_ITEM_TACKED:return"拥有道具（不扣除）";case t.N_MISSION:return"拥有任务";case t.N_PLAYER_PROP:return"玩家属性达到";case t.N_TALK_NPC:return"与NPC对话";case t.N_SKILL_LV:return"技能等级达到";case t.N_EQU:return"需要装备";case t.N_SKIN:return"需要皮肤";case t.N_SKILL:return"需要学会技能";case t.N_BUFF:return"需要BUFF状态";case t.R_ITEM:return"奖励道具";case t.R_MONEY:return"奖励游戏币";case t.R_EXP:return"奖励经验";case t.R_MISSION:return"奖励任务";default:for(var i=t.COSTOM_DEFINE.length,r=0;i>r;r++){var o=t.COSTOM_DEFINE[r];if(o.type==e)return o.key}}return null},t.SAVE_KEY=200,t.N_R_LINE=100,t.N_MONSTER_KILLED=0,t.N_ITEM_TACKED=1,t.N_ITEM_NEED=2,t.N_MISSION=3,t.N_PLAYER_PROP=4,t.N_TALK_NPC=5,t.N_SKILL_LV=6,t.N_SKIN=7,t.N_EQU=9,t.N_SKILL=10,t.N_BUFF=11,t.N_MONEY=12,t.N_MARK=13,t.N_MONEY_KEEP=14,t.R_ITEM=100,t.R_MONEY=101,t.R_EXP=102,t.R_MISSION=103,t.R_PLAYER_PROP=104,t.R_SKILL=105,t.COSTOM_DEFINE=[],t}();t.MissionNR=e,__reflect(e.prototype,"d5power.MissionNR")}(d5power||(d5power={}));var d5power;!function(t){var e=function(){function t(){this.itemid=0,this.number=0,this.packageid=0}return t}();t.PackageItemData=e,__reflect(e.prototype,"d5power.PackageItemData")}(d5power||(d5power={}));var d5power;!function(t){var e=function(){function e(t,i,r){this._intervalID=-1,e._that=this,this._objList=[],this._container=t,this._farLayer=new egret.DisplayObjectContainer,this._groundLayer=new egret.DisplayObjectContainer,this._lowLayer=new egret.DisplayObjectContainer,this._middleLayer=new egret.DisplayObjectContainer,this._topLayer=new egret.DisplayObjectContainer,t.addChild(this._farLayer),t.addChild(this._groundLayer),t.addChild(this._lowLayer),t.addChild(this._middleLayer),t.addChild(this._topLayer),this.map=i,this.camera=r}return e.prototype.start=function(){this._map&&this._camera&&-1==this._intervalID&&(this._intervalID=setInterval(this.run,Math.floor(1e3/t.D5Game.FPS)))},Object.defineProperty(e.prototype,"map",{set:function(t){t.setContainer(this._groundLayer),this._map=t,this.start()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"camera",{set:function(t){this._camera=t,this.start()},enumerable:!0,configurable:!0}),e.prototype.addObject=function(t){-1!=this._objList.indexOf(t)&&(this._objList.push(t),this._middleLayer.addChild(t.monitor))},e.prototype.run=function(){for(var t,i=e._that,r=egret.getTimer(),o=i._objList.length-1;o>=0;o--)t=i._objList[o],t.run(r);for(var o=i._objList.length-1;o>=0;o--)t=i._objList[o],t.render(r);i._camera.update(),i._map.render()},e}();t.D5World=e,__reflect(e.prototype,"d5power.D5World")}(d5power||(d5power={}));var d5power;!function(t){var e=function(){function t(){}return t}();t.D5Event=e,__reflect(e.prototype,"d5power.D5Event")}(d5power||(d5power={}));var d5power;!function(t){var e=function(){function t(){}return t.RELIVE=-1,t.Stop=8,t.Run=1,t.Sing=2,t.Attack=2,t.BowAtk=3,t.Sit=4,t.Die=5,t.Pickup=6,t.BeAtk=7,t.Wait=8,t}();t.Actions=e,__reflect(e.prototype,"d5power.Actions")}(d5power||(d5power={}));var d5power;!function(t){var e=function(){function e(t){void 0===t&&(t=null),this._tileFormat=".jpg",this._roadW=60,this._roadH=30,this._nowStartX=-1,this._nowStartY=-1,this._nowName="",this._tempPoint=new egret.Point,this._gameObjectManager=t}return e.rebuildPool=function(t){if(e._tilePool.length>t)for(;e._tilePool.length>t;)e._tilePool.pop();else for(;e._tilePool.length<t;)e._tilePool.push(new egret.Bitmap)},e.back2pool=function(t){-1==e._tilePool.indexOf(t)&&e._tilePool.push(t)},e.getTile=function(){var t;return t=e._tilePool.length?e._tilePool.pop():new egret.Bitmap,t.texture=null,t},e.prototype.createLoop=function(t,e,i,r,o,s){void 0===o&&(o=10),void 0===s&&(s=10);var n=this;RES.getResByUrl(e,function(e){n._mapid=t,n._tileW=e.textureWidth,n._tileH=e.textureHeight,n._mapHeight=this._tileH*s,n._mapWidth=this._tileW*o,n._onReady=i,n._onReadyThis=r,n._nowStartX=-1,n._nowStartY=-1,n._loopBg=e,n.setupRoad(null)},this)},e.prototype.enter=function(e,i,r){var o=this;RES.getResByUrl(t.D5Game.RES_SERVER+t.D5Game.ASSET_PATH+"/tiles/"+e+"/mapconf.json",function(t){o._data=t,o.setup(parseInt(t.id),parseInt(t.mapW),parseInt(t.mapH),parseInt(t.tileX),parseInt(t.tileY),i,r)},this)},Object.defineProperty(e.prototype,"id",{get:function(){return this._mapid},enumerable:!0,configurable:!0}),e.prototype.setContainer=function(t){t!=this._dbuffer&&(null!=this._dbuffer&&(this._dbuffer.removeChildren(),this._dbuffer.parent&&this._dbuffer.parent.removeChild(this._dbuffer)),this._dbuffer=t)},e.prototype.setTileFormat=function(t){"."!=t.substr(0,1)&&(t="."+t),this._tileFormat=t},e.prototype.setup=function(e,i,r,o,s,n,a){this._mapid=e,this._mapHeight=r,this._mapWidth=i,this._tileW=o,this._tileH=s,this._onReady=n,this._onReadyThis=a,this._nowStartX=-1,this._nowStartY=-1;var h=this,p=function(e){h._smallMap=new egret.SpriteSheet(e),h.createSmallData(e.textureWidth,e.textureHeight),RES.getResByUrl(t.D5Game.RES_SERVER+t.D5Game.ASSET_PATH+"/tiles/"+h._mapid+"/roadmap.bin",h.setupRoad,h,RES.ResourceItem.TYPE_BIN)};RES.getResByUrl(t.D5Game.RES_SERVER+t.D5Game.ASSET_PATH+"/tiles/"+this._mapid+"/s.jpg",p,this)},e.prototype.createSmallData=function(t,e){var i,r,o=t/(this._mapWidth/this._tileW),s=e/(this._mapHeight/this._tileH);for(r=0;r<this._mapWidth/this._tileW;r++)for(i=0;i<this._mapHeight/this._tileH;i++)this._smallMap.createTexture("small"+r+"_"+i,i*o,r*s,o,s,0,0)},Object.defineProperty(e.prototype,"width",{get:function(){return this._mapWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._mapHeight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tileWidth",{get:function(){return this._tileW},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tileHeight",{get:function(){return this._tileH},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"roadWidth",{get:function(){return this._roadW},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"roadHeight",{get:function(){return this._roadH},enumerable:!0,configurable:!0}),e.prototype.render=function(e){void 0===e&&(e=!1),this.mod_buffer&&(this.mod_buffer=!1,this._dbuffer.cacheAsBitmap=!0);var i=parseInt(t.Camera.zeroX/this._tileW),r=parseInt(t.Camera.zeroY/this._tileH);if(this.makeData(i,r,e),this._nowStartX==i&&this._nowStartY==r&&null!=this._posFlush){var o=t.Camera.zeroX%this._tileW,s=t.Camera.zeroY%this._tileH;this._dbuffer.x=-o,this._dbuffer.y=-s}},e.prototype.resize=function(){this._areaX=Math.ceil(t.D5Game.screenWidth/this._tileW)+1,this._areaY=Math.ceil(t.D5Game.screenHeight/this._tileH)+1,console.log("[D5Game] max tiles number ",this._areaX,this._areaY),e.rebuildPool(this._areaX*this._areaY+this._areaX+this._areaY)},e.prototype.resetRoad=function(){this._roadArr=[],this._alphaArr=[];for(var t=Math.floor(this._mapHeight/this._roadH),e=Math.floor(this._mapWidth/this._roadW),i=0;t>i;i++){for(var r=new Array,o=new Array,s=0;e>s;s++)r.push(0),o.push(0);this._roadArr.push(r),this._alphaArr.push(o)}},e.prototype.setRoad=function(t){this._roadArr=t},e.prototype.isInAlphaArea=function(t,i){var r=this.Postion2Tile(t,i);return this._alphaArr[r.y]&&this._alphaArr[r.y][r.x]==e.BIN_ALPHA_VALUE},e.prototype.getPointAround=function(e,i,r){if(!e||!i)return null;for(var o=0,s=5,n=2*Math.PI/s,a=new egret.Point,h=t.GMath.getPointAngle(e.x-i.x,e.y-i.y)+(Math.random()>.5?1:-1)*Math.PI/8;s>o;){var p=n*o+h;if(a.x=Math.round(e.x-r*Math.cos(p)),a.y=Math.round(e.y-r*Math.sin(p)),this.PointCanMove(a,i))return a;o++}return null},e.prototype.PointCanMove=function(t,e){if(null==this._astar)return!0;var i=this._astar.find(e.x,e.y,t.x,t.y);return null!=i},e.prototype.getRoadPass=function(t,e){return null==this._roadArr[e]||0!=this._roadArr[e][t]?!1:!0},e.prototype.findPath=function(t,e,i,r){return null==this._astar?null:this._astar.find(t,e,i,r)},e.prototype.getWorldPostion=function(e,i){return this._tempPoint.x=t.Camera.zeroX+e,this._tempPoint.y=t.Camera.zeroY+i,this._tempPoint},e.prototype.getScreenPostion=function(e,i){return this._tempPoint.x=e-t.Camera.zeroX,this._tempPoint.y=i-t.Camera.zeroY,this._tempPoint},e.prototype.tile2WorldPostion=function(t,e){return this._tempPoint.x=t*this._roadW+.5*this._roadW,this._tempPoint.y=e*this._roadH+.5*this._roadH,this._tempPoint},e.prototype.Postion2Tile=function(t,e){return this._tempPoint.x=Math.floor(t/this._roadW),this._tempPoint.y=Math.floor(e/this._roadH),this._tempPoint},e.prototype.reset=function(){this._tempPoint=new egret.Point,this._mapResource={tiles:new Object},this._dbuffer&&this._dbuffer.removeChildren()},e.prototype.setupRoad=function(i){if(null==i||void 0==i)this.resetRoad();else{var r,o=new egret.ByteArray(i),s=o.readUTFBytes(5),n=0,a=0;if("D5Map"==s){a=o.readShort(),n=o.readShort();for(var h=[],p=0;a>p;p++){for(var _=[],u=0;n>u;u++)_.push(o.readByte());h.push(_)}if(this.resetRoad(),n>1){var l=Math.floor(this._mapHeight/this._roadH),d=Math.floor(this._mapWidth/this._roadW),c=d==n&&l==a?1:a/l;for(p=0;l>p;p++)for(u=0;d>u;u++)try{a=Math.floor(p*c),n=Math.floor(u*c),r=h[a][n],this._roadArr[p][u]=r==e.BIN_NO_VALUE?1:0,this._alphaArr[p][u]=r}catch(f){trace("［BaseMap］路点超出范围Y:X("+p+":"+u+")",a,n),this._roadArr[p][u]=e.BIN_NO_VALUE,this._alphaArr[p][u]=e.BIN_NO_VALUE}}}else console.log("[BaseMap]非法的地图配置文件")}this.reset(),this.resize(),this._astar=new t.SilzAstar(this._roadArr);var y=this._data&&this._data.npc?this._data.npc.length:0;if(null!=this._gameObjectManager)for(var m=0;y>m;m++){var g=new t.NPConf;g.format(this._data.npc[m]),this._gameObjectManager.addNPC(g)}null!=this._onReady&&this._onReady.apply(this._onReadyThis)},e.prototype.makeData=function(t,e,i){if(this._nowStartX!=t||this._nowStartY!=e){this._nowStartX=t,this._nowStartY=e,this._posFlush=[];for(var r=0,o=this._dbuffer.numChildren;o>r;r++)this._dbuffer.getChildAt(r).texture=null;for(var s,n=Math.min(e+this._areaY,Math.floor(this._mapHeight/this._tileH)),a=Math.min(t+this._areaX,Math.floor(this._mapWidth/this._tileW)),h=e;n>h;h++)for(var p=t;a>p;p++)s=h+"_"+p,0>p||0>h||(null==this._mapResource.tiles[s]?this._loopBg?this.fillTile(p-this._nowStartX,h-this._nowStartY,this._loopBg):(this._posFlush.push(h+"_"+p+"_"+this._nowStartX+"_"+this._nowStartY+"_"+this._mapid),this.fillSmallMap(h,p,p-this._nowStartX,h-this._nowStartY)):this.fillTile(p-this._nowStartX,h-this._nowStartY,this._mapResource.tiles[s]));null==this._loopBg&&this.loadTiles()}},e.prototype.clear=function(){this._mapResource={tiles:new Object};for(var t;this._dbuffer.numChildren;)t=this._dbuffer.removeChildAt(0),t.texture=null,e.back2pool(t);this._nowName="",this._tileFormat=".jpg"},e.prototype.loadTiles=function(e){if(void 0===e&&(e=null),null!=e){var i=this._nowName.split("_");if(parseInt(i[4])!=this._mapid)return void console.log("[BaseMap] 读取了已切换了的地图资源");var r=i[0]+"_"+i[1];null==this._mapResource.tiles[r]&&(this._mapResource.tiles[r]=e);var o=parseInt(i[1])-this._nowStartX,s=parseInt(i[0])-this._nowStartY;parseInt(i[2])==this._nowStartX&&parseInt(i[3])==this._nowStartY&&this.fillTile(o,s,e),this._nowName=""}if(0==this._posFlush.length)this._dbuffer.cacheAsBitmap=!1,this.mod_buffer=!0;else if(""==this._nowName){this._nowName=this._posFlush.pop();var i=this._nowName.split("_"),n=t.D5Game.RES_SERVER+t.D5Game.ASSET_PATH+"/tiles/"+this._mapid+"/"+i[0]+"_"+i[1]+this._tileFormat;RES.getResByUrl(n,this.loadTiles,this)}},e.prototype.fillTile=function(t,i,r){var o=this._dbuffer.getChildByName(t+"_"+i);null==o&&(o=e.getTile(),o.x=t*this._tileW,o.y=i*this._tileH,o.name=t+"_"+i,this._dbuffer.addChild(o)),o.texture=r,this._dbuffer.cacheAsBitmap=!0},e.prototype.fillSmallMap=function(t,i,r,o){if(this._smallMap){var s=this._smallMap.getTexture("small"+t+"_"+i),n=this._dbuffer.getChildByName(r+"_"+o);null==n&&(n=e.getTile(),n.x=r*this._tileW,n.y=o*this._tileH,n.fillMode=egret.BitmapFillMode.SCALE,n.name=r+"_"+o,this._dbuffer.addChild(n)),n.texture=s,n.width=this._tileW,n.height=this._tileH,this._dbuffer.cacheAsBitmap=!0}},e.BIN_ALPHA_VALUE=2,e.BIN_CAN_VALUE=1,e.BIN_NO_VALUE=0,e._tilePool=new Array,e}();t.BaseMap=e,__reflect(e.prototype,"d5power.BaseMap",["d5power.IMap"])}(d5power||(d5power={}));var d5power;!function(t){var e=function(){function e(t){this._zorderSpeed=600,this._moveSpeed=1,this._moveAngle=0,null==e._cameraView&&(e._cameraView=new egret.Rectangle),this._cameraCutView=new egret.Rectangle,this._map=t}return Object.defineProperty(e,"needreCut",{get:function(){return e.$needreCut},enumerable:!0,configurable:!0}),e.prototype.setZero=function(i,r){i=Math.ceil(i),r=Math.ceil(r),e.zeroX=i,e.zeroY=r;var o=this._map.width-t.D5Game.screenWidth;e.zeroX=e.zeroX<0?0:e.zeroX,this._map.width>t.D5Game.screenWidth&&(e.zeroX=e.zeroX>o?o:e.zeroX),o=this._map.height-t.D5Game.screenHeight,e.zeroY=e.zeroY<0?0:e.zeroY,this._map.height>t.D5Game.screenHeight&&(e.zeroY=e.zeroY>o?o:e.zeroY)},e.prototype.update=function(){this._focus&&this.setZero(this._focus.posX-(t.D5Game.screenWidth>>1),this._focus.posY-(t.D5Game.screenHeight>>1)),e._cameraView.x=e.zeroX,e._cameraView.y=e.zeroY,e._cameraView.width=t.D5Game.screenWidth,e._cameraView.height=t.D5Game.screenHeight},Object.defineProperty(e.prototype,"focus",{get:function(){return this._focus},set:function(t){this._focus&&(this._focus.beFocus=!1),this._focus=t,t.beFocus=!0,this.update(),this.reCut()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"moveSpeed",{set:function(t){this._moveSpeed=t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"cameraView",{get:function(){return e._cameraView},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cameraCutView",{get:function(){var i=e.zeroX,r=e.zeroY;return i>0&&(i-=2*this._map.tileWidth),i>0&&(r-=r-2*this._map.tileHeight),i=0>i?0:i,r=0>r?0:r,this._cameraCutView.x=i,this._cameraCutView.y=r,this._cameraCutView.width=t.D5Game.screenWidth+2*this._map.tileWidth,this._cameraCutView.height=t.D5Game.screenHeight+2*this._map.tileHeight,this._cameraCutView},enumerable:!0,configurable:!0}),e.prototype.moveNorth=function(t){void 0===t&&(t=1),0!=this._moveSpeed&&0!=e.zeroY&&(this.focus=null,this.setZero(e.zeroX,e.zeroY-this._moveSpeed*t),this.reCut())},e.prototype.moveSourth=function(t){void 0===t&&(t=1),0!=this._moveSpeed&&(this.focus=null,this.setZero(e.zeroX,e.zeroY+this._moveSpeed*t),this.reCut())},e.prototype.moveWest=function(t){void 0===t&&(t=1),0!=this._moveSpeed&&0!=e.zeroX&&(this.focus=null,this.setZero(e.zeroX-this._moveSpeed*t,e.zeroY),this.reCut())},e.prototype.moveEast=function(t){void 0===t&&(t=1),0!=this._moveSpeed&&(this.focus=null,this.setZero(e.zeroX+this._moveSpeed*t,e.zeroY),this.reCut())},e.prototype.move=function(t,i,r){void 0===r&&(r=1),this.focus=null,this.setZero(e.zeroX+this._moveSpeed*t*r,e.zeroY+this._moveSpeed*i*r),this.reCut()},e.prototype.lookAt=function(e,i){this.focus=null,this.setZero(e-(t.D5Game.screenWidth>>1),i-(t.D5Game.screenHeight>>1)),this.reCut()},e.prototype.flyTo=function(i,r,o){return void 0===o&&(o=null),null!=this._timer?void console.log("[D5Camera] Camera is moving,can not do this operation."):(this.focus=null,this._moveCallBack=o,this._moveStart=new egret.Point(e.zeroX-(t.D5Game.screenWidth>>1),e.zeroY-(t.D5Game.screenHeight>>1)),this._moveEnd=new egret.Point(i-(t.D5Game.screenWidth>>1),r-(t.D5Game.screenHeight>>1)),this._timer=new egret.Timer(50),this._timer.addEventListener(egret.TimerEvent.TIMER,this.moveCamera,this),void this._timer.start())},e.prototype.moveCamera=function(t){var e=8,i=(this._moveEnd.x-this._moveStart.x)/e,r=(this._moveEnd.y-this._moveStart.y)/e;this._moveStart.x+=i,this._moveStart.y+=r,this.setZero(this._moveStart.x,this._moveStart.y),i>-.2&&.2>i&&r>-.2&&.2>r&&(this._moveEnd=null,this._timer.stop(),this._timer.removeEventListener(egret.TimerEvent.TIMER,this.moveCamera,this),this._timer=null,this.reCut(),null!=this._moveCallBack&&this._moveCallBack())},Object.defineProperty(e.prototype,"zorderSpeed",{get:function(){return this._zorderSpeed},enumerable:!0,configurable:!0}),e.prototype.reCut=function(){},e.zeroX=0,e.zeroY=0,e.RenderMaxTime=10,e}();t.Camera=e,__reflect(e.prototype,"d5power.Camera")}(d5power||(d5power={}));var d5power;!function(t){var e=function(){function t(){}return t.Down=0,t.LeftDown=1,t.Left=2,t.LeftUp=3,t.Up=4,t.RightUp=5,t.Right=6,t.RightDown=7,t}();t.Direction=e,__reflect(e.prototype,"d5power.Direction")}(d5power||(d5power={}));var d5power;!function(t){var e=function(){function t(){}return t.getPointAngle=function(t,e){return Math.atan2(e,t)},t.R2A=function(e){return e*t.K_R2A},t.A2R=function(e){return void 0===e&&(e=0),e*t.K_A2R},t.K_R2A=180/Math.PI,t.K_A2R=Math.PI/180,t}();t.GMath=e,__reflect(e.prototype,"d5power.GMath")}(d5power||(d5power={}));var d5power;!function(t){var e=function(){function t(){this._missionList=[],this._itemList=[]}return t.prototype.getMission=function(t){-1==this._missionList.indexOf(t)&&this._missionList.push(t)},t}();t.PlayerData=e,__reflect(e.prototype,"d5power.PlayerData")}(d5power||(d5power={}));var d5power;!function(t){var e=function(){function t(t,e){void 0===e&&(e=null),this._cellSize=5,this.path=new egret.Sprite,this.image=new egret.Bitmap,this.imageWrapper=new egret.DisplayObjectContainer,this.isDisplayMode=!1,null!=e?(this.isDisplayMode=!0,this.imageWrapper.addChild(this.image),e.addChild(this.imageWrapper),this.imageWrapper.addChild(this.path)):this.isDisplayMode=!1,this.makeGrid(t)}return Object.defineProperty(t.prototype,"WORKMODE",{set:function(t){if(8!=t&&4!=t)throw new Error("仅支持8方向或4方向寻路")},enumerable:!0,configurable:!0}),t.prototype.find=function(t,e,i,r){if(i=Math.min(i,this._grid.numCols-1),r=Math.min(r,this._grid.numRows-1),i=Math.max(i,0),r=Math.max(r,0),!this._grid.nodeValuable(i,r))return null;if(this._grid.setEndNode(i,r),t=Math.min(t,this._grid.numCols-1),e=Math.min(e,this._grid.numRows-1),t=Math.max(t,0),e=Math.max(e,0),!this._grid.nodeValuable(t,e))return null;if(this._grid.setStartNode(t,e),this.isDisplayMode)var o=egret.getTimer();if(this.astar.findPath()){if(this._index=0,this.astar.floyd(),this._path=this.astar.floydPath,this.isDisplayMode){o=egret.getTimer()-o,console.log("[SilzAstar]",o+"ms   length:"+this.astar.path.length),console.log("[SilzAstar]",this.astar.floydPath),this.path.graphics.clear();for(var s=0;s<this.astar.floydPath.length;s++){var n=this.astar.floydPath[s];this.path.graphics.lineStyle(0,16711680),this.path.graphics.drawCircle((n.x+.5)*this._cellSize,(n.y+.5)*this._cellSize,2),this.path.graphics.lineStyle(0,16711680,.5),this.path.graphics.moveTo(t,e)}}return this._path}return this.isDisplayMode&&(this._grid.setEndNode(i-1,r-1),o=egret.getTimer()-o,console.log("[SilzAstar]",o+"ms 找不到")),null},t.prototype.makeGrid=function(e){var r=e.length,s=e[0].length;this._grid=new o(s,r);var n,a;for(a=0;r>a;a++)for(n=0;s>n;n++)this._grid.setWalkable(n,a,0==e[a][n]);4==t.WorkMode?this._grid.calculateLinks(1):this._grid.calculateLinks(),this.astar=new i(this._grid),this.isDisplayMode&&(this.drawGrid(),this.path.graphics.clear())},t.prototype.drawGrid=function(){console.log("fuck")},t.prototype.getColor=function(t){return t.walkable?t==this._grid.startNode?13421772:t==this._grid.endNode?13421772:16777215:0},t.WorkMode=8,t}();t.SilzAstar=e,__reflect(e.prototype,"d5power.SilzAstar");var i=function(){function t(t){this._straightCost=1,this._diagCost=Math.SQRT2,this.nowversion=1,this.TwoOneTwoZero=2*Math.cos(Math.PI/3),this._grid=t,this.heuristic=this.euclidian2}return t.prototype.justMin=function(t,e){return t.f<e.f},t.prototype.findPath=function(){return this._endNode=this._grid.endNode,this.nowversion++,this._startNode=this._grid.startNode,this._open=new r(this.justMin),this._startNode.g=0,this.search()},t.prototype.floyd=function(){if(null!=this.path){this._floydPath=this.path.concat();var t=this._floydPath.length;if(t>2){var e=new n(0,0),i=new n(0,0);this.floydVector(e,this._floydPath[t-1],this._floydPath[t-2]);for(var r=this._floydPath.length-3;r>=0;r--)this.floydVector(i,this._floydPath[r+1],this._floydPath[r]),e.x==i.x&&e.y==i.y?this._floydPath.splice(r+1,1):(e.x=i.x,e.y=i.y)}for(t=this._floydPath.length,r=t-1;r>=0;r--)for(var o=0;r-2>=o;o++)if(this.floydCrossAble(this._floydPath[r],this._floydPath[o])){for(var s=r-1;s>o;s--)this._floydPath.splice(s,1);r=o,t=this._floydPath.length;break}}},t.prototype.floydCrossAble=function(t,e){for(var i=this.bresenhamNodes(new egret.Point(t.x,t.y),new egret.Point(e.x,e.y)),r=i.length-2;r>0;r--)if(!this._grid.getNode(i[r].x,i[r].y).walkable)return!1;return!0},t.prototype.bresenhamNodes=function(t,e){var i=Math.abs(e.y-t.y)>Math.abs(e.x-t.x);if(i){var r=t.x;t.x=t.y,t.y=r,r=e.x,e.x=e.y,e.y=r}var o=e.x>t.x?1:e.x<t.x?-1:0,s=(e.y>t.y?1:e.y<t.y?-1:0,(e.y-t.y)/Math.abs(e.x-t.x)),n=[],a=t.x+o,h=t.y+s;for(i?n.push(new egret.Point(t.y,t.x)):n.push(new egret.Point(t.x,t.y));a!=e.x;){var p=Math.floor(h),_=Math.ceil(h);i?n.push(new egret.Point(p,a)):n.push(new egret.Point(a,p)),p!=_&&(i?n.push(new egret.Point(_,a)):n.push(new egret.Point(a,_))),a+=o,h+=s}return i?n.push(new egret.Point(e.y,e.x)):n.push(new egret.Point(e.x,e.y)),n},t.prototype.floydVector=function(t,e,i){t.x=e.x-i.x,t.y=e.y-i.y},t.prototype.search=function(){var t=this._startNode;for(t.version=this.nowversion;t!=this._endNode;){for(var e=t.links.length,i=0;e>i;i++){var r=t.links[i].node,o=t.links[i].cost,s=t.g+o,n=this.heuristic(r),a=s+n;r.version==this.nowversion?r.f>a&&(r.f=a,r.g=s,r.h=n,r.parent=t):(r.f=a,r.g=s,r.h=n,r.parent=t,this._open.ins(r),r.version=this.nowversion)}if(1==this._open.a.length)return!1;t=this._open.pop()}return this.buildPath(),!0},t.prototype.buildPath=function(){this._path=[];var t=this._endNode;for(this._path.push(t);t!=this._startNode;)t=t.parent,this._path.unshift(t)},Object.defineProperty(t.prototype,"path",{get:function(){return this._path},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"floydPath",{get:function(){return this._floydPath},enumerable:!0,configurable:!0}),t.prototype.manhattan=function(t){return Math.abs(t.x-this._endNode.x)+Math.abs(t.y-this._endNode.y)},t.prototype.manhattan2=function(t){var e=Math.abs(t.x-this._endNode.x),i=Math.abs(t.y-this._endNode.y);return e+i+Math.abs(e-i)/1e3},t.prototype.euclidian=function(t){var e=t.x-this._endNode.x,i=t.y-this._endNode.y;return Math.sqrt(e*e+i*i)},t.prototype.chineseCheckersEuclidian2=function(t){var e=t.y/this.TwoOneTwoZero,i=t.x+t.y/2,r=i-this._endNode.x-this._endNode.y/2,o=e-this._endNode.y/this.TwoOneTwoZero;
return this.sqrt(r*r+o*o)},t.prototype.sqrt=function(t){return Math.sqrt(t)},t.prototype.euclidian2=function(t){var e=t.x-this._endNode.x,i=t.y-this._endNode.y;return e*e+i*i},t.prototype.diagonal=function(t){var e=Math.abs(t.x-this._endNode.x),i=Math.abs(t.y-this._endNode.y),r=Math.min(e,i),o=e+i;return this._diagCost*r+this._straightCost*(o-2*r)},t}();t.AStar=i,__reflect(i.prototype,"d5power.AStar");var r=function(){function t(t){void 0===t&&(t=null),this.a=[],this.justMinFun=function(t,e){return this.x<this.y},this.a.push(-1),null!=t&&(this.justMinFun=t)}return t.prototype.ins=function(t){var e=this.a.length;this.a[e]=t;for(var i=e>>1;e>1&&this.justMinFun(this.a[e],this.a[i]);){var r=this.a[e];this.a[e]=this.a[i],this.a[i]=r,e=i,i=e>>1}},t.prototype.pop=function(){var t=this.a[1];this.a[1]=this.a[this.a.length-1],this.a.pop();for(var e=1,i=this.a.length,r=e<<1,o=r+1;i>r;){if(i>o)var s=this.justMinFun(this.a[o],this.a[r])?o:r;else s=r;if(!this.justMinFun(this.a[s],this.a[e]))break;var n=this.a[e];this.a[e]=this.a[s],this.a[s]=n,e=s,r=e<<1,o=r+1}return t},t}();t.BinaryHeap=r,__reflect(r.prototype,"d5power.BinaryHeap");var o=function(){function t(t,e){this._straightCost=1,this._diagCost=Math.SQRT2,this._numCols=t,this._numRows=e,this._nodes=new Array;for(var i=0;i<this._numCols;i++){this._nodes[i]=new Array;for(var r=0;r<this._numRows;r++)this._nodes[i][r]=new n(i,r)}}return t.prototype.calculateLinks=function(t){void 0===t&&(t=0),this.type=t;for(var e=0;e<this._numCols;e++)for(var i=0;i<this._numRows;i++)this.initNodeLink(this._nodes[e][i],t)},t.prototype.getType=function(){return this.type},t.prototype.initNodeLink=function(t,e){var i=Math.max(0,t.x-1),r=Math.min(this.numCols-1,t.x+1),o=Math.max(0,t.y-1),n=Math.min(this.numRows-1,t.y+1);t.links=[];for(var a=i;r>=a;a++)for(var h=o;n>=h;h++){var p=this.getNode(a,h);if(p!=t&&p.walkable){if(2!=e&&a!=t.x&&h!=t.y){var _=this.getNode(t.x,h);if(!_.walkable)continue;if(_=this.getNode(a,t.y),!_.walkable)continue}var u=this._straightCost;if(t.x!=p.x&&t.y!=p.y){if(1==e)continue;if(2==e&&(t.x-p.x)*(t.y-p.y)==1)continue;u=2==e?this._straightCost:this._diagCost}t.links.push(new s(p,u))}}},t.prototype.nodeValuable=function(t,e){return this._nodes&&this._nodes[t]&&this._nodes[t][e]?!0:!1},t.prototype.getNode=function(t,e){return this._nodes[t][e]},t.prototype.setEndNode=function(t,e){this._endNode=this._nodes[t][e]},t.prototype.setStartNode=function(t,e){this._startNode=this._nodes[t][e]},t.prototype.setWalkable=function(t,e,i){this._nodes[t][e].walkable=i},Object.defineProperty(t.prototype,"endNode",{get:function(){return this._endNode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numCols",{get:function(){return this._numCols},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numRows",{get:function(){return this._numRows},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"startNode",{get:function(){return this._startNode},enumerable:!0,configurable:!0}),t}();t.Grid=o,__reflect(o.prototype,"d5power.Grid");var s=function(){function t(t,e){this.node=t,this.cost=e}return t}();t.Link=s,__reflect(s.prototype,"d5power.Link");var n=function(){function t(t,e){this.walkable=!0,this.version=1,this.x=t,this.y=e}return t.prototype.toString=function(){return"x:"+this.x+" y:"+this.y},t}();t.SilzAstarNode=n,__reflect(n.prototype,"d5power.SilzAstarNode")}(d5power||(d5power={}));var d5power;!function(t){var e=function(e){function i(t){var i=e.call(this,t)||this;return i._waitAction=-1,i}return __extends(i,e),i.prototype.run=function(e){if(this._targetPoint){var i=t.GMath.getPointAngle(this._targetPoint.x-this._pos.x,this._targetPoint.y-this._pos.y),r=t.GMath.R2A(i)+90;this._faceAngle!=r&&(this.faceAngle=r);var o=!1,s=!1,n=this.speed*Math.cos(i),a=this.speed*Math.sin(i);Math.abs(this._pos.x-this._targetPoint.x)<=1&&(o=!0,n=0),Math.abs(this._pos.y-this._targetPoint.y)<=1&&(s=!0,a=0),this.setPos(this._pos.x+n,this._pos.y+a),o&&s&&(this._targetPoint=null,this.action=t.Actions.Wait)}this.updatePos()},i.prototype.move2Tile=function(e,i){e=Math.ceil(e),i=Math.ceil(i);var r=this._map.tile2WorldPostion(e,i);this._targetPoint?(this._targetPoint.x=r.x,this._targetPoint.y=r.y):this._targetPoint=new egret.Point(r.x,r.y),this.action=t.Actions.Run},i.prototype.setSkin=function(t,e,i){var r=this,o=function(o){null==o?e.apply(i,null):(r._texture=o,RES.getResByUrl(t+"tex.json",s,this))},s=function(o){null==o?e.apply(i,null):(r._texture_data=o,RES.getResByUrl(t+"ske.json",n,this))},n=function(t){null==t?e.apply(i,null):(r._data=t,r._onReady=e,r._onReady_obj=i,this.setup())};"/"!=t.substr(-1)&&(t+="/"),RES.getResByUrl(t+"tex.png",o,this)},i.prototype.setup=function(){this._factory&&this._factory.dispose(),this._monitor&&(this._monitor.parent.removeChild(this._monitor),this._monitor.dispose()),this._factory=new dragonBones.EgretFactory,this._factory.addDragonBonesData(dragonBones.DataParser.parseDragonBonesData(this._data)),this._factory.addTextureAtlas(new dragonBones.EgretTextureAtlas(this._texture,this._texture_data)),this._monitor=this._factory.buildArmatureDisplay("armatureName"),this._texture_data.scale&&(this._monitor.scaleX=this._monitor.scaleY=this._texture_data.scale),this.setPos(this._pos.x,this._pos.y),this.faceAngle=this._faceAngle,this._onReady.apply(this._onReady_obj,[this]),-1!=this._waitAction&&(this.action=this._waitAction)},Object.defineProperty(i.prototype,"action",{set:function(t){return this._monitor?(this._monitor.animation.play("action"+t),void(this._waitAction=-1)):void(this._waitAction=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"faceAngle",{set:function(t){if(this._faceAngle=t,this._monitor){var e=Math.abs(this._monitor.scaleX);-22.5>t&&(t+=360),t>=-22.5&&22.5>t||(t>=22.5&&67.5>t?this._monitor.scaleX=-1*e:t>=67.5&&112.5>t?this._monitor.scaleX=-1*e:t>=112.5&&157.5>t?this._monitor.scaleX=-1*e:t>=157.5&&202.5>t||(t>=202.5&&247.5>t?this._monitor.scaleX=e:t>=247.5&&292.5>t?this._monitor.scaleX=e:this._monitor.scaleX=e))}},enumerable:!0,configurable:!0}),i}(t.GameObject);t.BoneCharacter=e,__reflect(e.prototype,"d5power.BoneCharacter")}(d5power||(d5power={}));var d5power;!function(t){var e=function(e){function i(t){var i=e.call(this,t)||this;return i._action=0,i._dir=0,i._playFrame=0,i._lastTimer=0,i._data_renderTime=0,i._data_totalFrame=0,i._data_totalDir=0,i._offX=0,i._offY=0,i._monitor=new egret.Bitmap,i}return __extends(i,e),i.prototype.addDisplayPlugin=function(e,i,r){void 0===i&&(i=0),void 0===r&&(r=0);var o=new t.DisplayPluginData;o.offX=i,o.offY=r,o.obj=e,this._plugin_list.push(o),this._monitor.parent},i.prototype.move2Tile=function(e,i){e=Math.ceil(e),i=Math.ceil(i);var r=this._map.tile2WorldPostion(e,i);this._targetPoint?(this._targetPoint.x=r.x,this._targetPoint.y=r.y):this._targetPoint=new egret.Point(r.x,r.y),this.action=t.Actions.Run},Object.defineProperty(i.prototype,"dir",{set:function(t){t!=this._dir&&(this._dir=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"monitor",{get:function(){return this._monitor},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"action",{set:function(e){this._skin&&null!=this._skin&&e!=this._action&&(null==this._sheet?this._sheet=t.D5SpriteSheet.getInstance(this._skin+e,this):this._sheet=t.D5SpriteSheet.getInstance(this._skin+e,this))},enumerable:!0,configurable:!0}),i.prototype.setSkin=function(e){var i=e.lastIndexOf("/"),r=e.substr(i+1);e=e.substr(0,i)+"/",this._skin=e,parseInt(r)>0?this.action=parseInt(r):this.action=t.Actions.Wait},i.prototype.onSpriteSheepReady=function(t){this._data_renderTime=t.renderTime,this._data_totalFrame=t.totalFrame,this._data_totalDir=t.totalDirection,this.render(egret.getTimer())},i.prototype.run=function(i){if(e.prototype.run.call(this,i),this._targetPoint){var r=t.GMath.getPointAngle(this._targetPoint.x-this._pos.x,this._targetPoint.y-this._pos.y),o=t.GMath.R2A(r)+90;this._faceAngle!=o&&(this.faceAngle=o);var s=!1,n=!1,a=this.speed*Math.cos(r),h=this.speed*Math.sin(r);Math.abs(this._pos.x-this._targetPoint.x)<=1&&(s=!0,a=0),Math.abs(this._pos.y-this._targetPoint.y)<=1&&(n=!0,h=0),this.setPos(this._pos.x+a,this._pos.y+h),s&&n&&(this._targetPoint=null,this.action=t.Actions.Wait)}},i.prototype.render=function(t){if(this._sheet&&!(t-this._lastTimer<this._sheet.renderTime)){this._lastTimer=t;var e=this._dir;this._playFrame>=this._sheet.totalFrame&&(this._playFrame=0),this._dir<=4?(1==this._sheet.totalDirection?(e=0,this._monitor.texture=this._sheet.getTexture(e,this._playFrame)):4==this._sheet.totalDirection?((1==e||2==e||3==e)&&(e=1),this._monitor.texture=this._sheet.getTexture(e,this._playFrame)):this._monitor.texture=this._sheet.getTexture(e,this._playFrame),this._monitor.scaleX=1,this._sheet.uvList?(this._offX=this._sheet.uvList[e*this._sheet.totalFrame+this._playFrame].offX,this._offY=this._sheet.uvList[e*this._sheet.totalFrame+this._playFrame].offY):(this._offX=this._sheet.gX,this._offY=this._sheet.gY)):(1==this._sheet.totalDirection?(e=0,this._monitor.texture=this._sheet.getTexture(e,this._playFrame)):4==this._sheet.totalDirection?(e=1,this._monitor.texture=this._sheet.getTexture(e,this._playFrame)):(e=8-this._dir,this._monitor.texture=this._sheet.getTexture(e,this._playFrame)),this._monitor.scaleX=-1,this._sheet.uvList?(this._offX=-this._sheet.uvList[e*this._sheet.totalFrame+this._playFrame].offX,this._offY=this._sheet.uvList[e*this._sheet.totalFrame+this._playFrame].offY):(this._offX=-this._sheet.gX,this._offY=this._sheet.gY)),this._playFrame++,this.updatePos(this._offX,this._offY)}},Object.defineProperty(i.prototype,"faceAngle",{set:function(e){this._faceAngle=e,-22.5>e&&(e+=360),e>=-22.5&&22.5>e?this._dir=t.Direction.Up:e>=22.5&&67.5>e?this._dir=t.Direction.RightUp:e>=67.5&&112.5>e?this._dir=t.Direction.Right:e>=112.5&&157.5>e?this._dir=t.Direction.RightDown:e>=157.5&&202.5>e?this._dir=t.Direction.Down:e>=202.5&&247.5>e?this._dir=t.Direction.LeftDown:e>=247.5&&292.5>e?this._dir=t.Direction.Left:this._dir=t.Direction.LeftUp},enumerable:!0,configurable:!0}),i}(t.GameObject);t.FrameCharacter=e,__reflect(e.prototype,"d5power.FrameCharacter",["d5power.ISpriteSheetWaiter"])}(d5power||(d5power={}));var d5power;!function(t){var e=function(){function t(){}return t.MI=50,t.RES_SERVER="",t.ASSET_PATH="resource/assets/",t.screenWidth=1280,t.screenHeight=800,t.timer=0,t.FPS=45,t}();t.D5Game=e,__reflect(e.prototype,"d5power.D5Game")}(d5power||(d5power={}));